--[[
    LAJ HUB V3.0 ULTRA - Premium Roblox Exploit Hub
    Developed by: LAJ Development Team
    
    Features:
    - Advanced script organization by game & category
    - Script search and favorites system
    - Player utilities (ESP, teleport, etc.)
    - Auto-execute functionality
    - Custom theme settings
    - Premium scripts with special access
    - Executor compatibility checks
    - Game detection and script recommendations
    
    Discord: https://discord.gg/4mgdcfvAJU
]]

-- Enhanced executor compatibility with comprehensive support for all major executors
local executorFunctions = {
    ["HttpGet"] = (syn and syn.request) or (http and http.request) or (game and game.HttpGet) or (request) or
                 (http_request) or (HttpPost) or (fluxus and fluxus.request) or (delta and delta.request) or 
                 (crypt and crypt.request) or (KRNL_LOADED and request) or (Oxygen and Oxygen.HttpRequest),
    ["Execute"] = loadstring or (syn and syn.load) or (getgenv().loadstring),
    ["FileSystem"] = (writefile and readfile and isfile) ~= nil,
    ["AssetSupport"] = (getcustomasset or getsynasset) ~= nil,
    ["ClipboardSupport"] = (setclipboard or (syn and syn.write_clipboard) or (Clipboard and Clipboard.set)) ~= nil
}

-- Check if the executor can run LAJ HUB properly
local function canExecuteHub()
    -- Minimum requirement is HTTP capability
    return executorFunctions["HttpGet"] ~= nil
end

-- Add fallback error display if the executor is incompatible
if not canExecuteHub() then
    local errorMessage = "LAJ HUB requires an executor with HTTP request support.\n"
    errorMessage = errorMessage .. "Please use Synapse X, KRNL, Fluxus, Delta, or another modern executor."
    
    -- Try to display a visual message if possible
    pcall(function()
        local messageGui = Instance.new("ScreenGui")
        messageGui.Name = "LAJHubError"
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0, 300, 0, 150)
        frame.Position = UDim2.new(0.5, -150, 0.5, -75)
        frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        frame.BorderSizePixel = 0
        frame.Parent = messageGui
        
        local title = Instance.new("TextLabel")
        title.Text = "LAJ HUB - Compatibility Error"
        title.Size = UDim2.new(1, 0, 0, 30)
        title.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
        title.TextColor3 = Color3.fromRGB(255, 255, 255)
        title.BorderSizePixel = 0
        title.Font = Enum.Font.SourceSansBold
        title.TextSize = 18
        title.Parent = frame
        
        local message = Instance.new("TextLabel")
        message.Text = errorMessage
        message.Size = UDim2.new(1, -20, 1, -40)
        message.Position = UDim2.new(0, 10, 0, 35)
        message.BackgroundTransparency = 1
        message.TextColor3 = Color3.fromRGB(255, 255, 255)
        message.TextWrapped = true
        message.Font = Enum.Font.SourceSans
        message.TextSize = 14
        message.Parent = frame
        
        -- Attempt to parent to CoreGui or PlayerGui as fallback
        if syn and syn.protect_gui then
            syn.protect_gui(messageGui)
            messageGui.Parent = game:GetService("CoreGui")
        elseif gethui then
            messageGui.Parent = gethui()
        elseif game:GetService("CoreGui") then
            messageGui.Parent = game:GetService("CoreGui")
        else
            messageGui.Parent = game:GetService("Players").LocalPlayer.PlayerGui
        end
    end)
    
    warn(errorMessage)
    return
end

-- Initialize UI with error handling
local Success, Rayfield = pcall(function()
    return loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
end)

if not Success then
    -- Fallback UI if Rayfield fails
    loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
    error("Failed to load Rayfield UI. Loaded Infinite Yield as fallback.")
    return
end

-- Set up global utilities
local LAJ = {
    Version = "3.0 ULTRA",
    Config = {},
    Cache = {},
    Favorites = {},
    History = {},
    API = {},
    WebhookURL = "https://discord.com/api/webhooks/1357395980299014224/VHqKfAsLDqGIUQ5icewgv8YX-SblIBEsmG3NmaMG83y68hQcGrfTEXmdW0rCy0P98zuz"
}

-- Discord webhook function compatible with all executors (including Delta)
LAJ.SendDiscordWebhook = function(message)
    if LAJ.WebhookURL then
        pcall(function()
            local data = {
                ["content"] = message,
                ["embeds"] = {{
                    ["title"] = "LAJ HUB Usage Notification",
                    ["description"] = message,
                    ["color"] = 5814783,
                    ["footer"] = {
                        ["text"] = "LAJ HUB " .. LAJ.Version
                    },
                    ["timestamp"] = os.date("%Y-%m-%dT%H:%M:%S", os.time())
                }}
            }
            
            local httpService = game:GetService("HttpService")
            local headers = {["Content-Type"] = "application/json"}
            local finalData = httpService:JSONEncode(data)
            
            -- Support for all executors including Delta
            local request_func
            if syn and syn.request then
                request_func = syn.request
            elseif http and http.request then
                request_func = http.request
            elseif http_request then
                request_func = http_request
            elseif request then
                request_func = request
            elseif HttpPost then
                request_func = HttpPost
            elseif fluxus and fluxus.request then
                request_func = fluxus.request
            elseif delta and delta.request then
                request_func = delta.request
            elseif KRNL_LOADED and request then
                request_func = request
            elseif crypt and crypt.request then
                request_func = crypt.request
            end
            
            if request_func then
                request_func({
                    Url = LAJ.WebhookURL,
                    Method = "POST",
                    Headers = headers,
                    Body = finalData
                })
            else
                print("Warning: No HTTP request function found for your executor")
            end
        end)
    end
end

-- Advanced error handling and logging
LAJ.Log = function(type, message)
    local colors = {
        ["Info"] = Color3.fromRGB(0, 255, 255),
        ["Success"] = Color3.fromRGB(0, 255, 0),
        ["Warning"] = Color3.fromRGB(255, 255, 0),
        ["Error"] = Color3.fromRGB(255, 0, 0),
        ["Debug"] = Color3.fromRGB(180, 180, 180)
    }
    
    if type == "Error" then
        warn("[LAJ HUB] " .. message)
    elseif type == "Debug" then
        print("[LAJ DEBUG] " .. message)
    end
    
    if Rayfield then
        Rayfield:Notify({
            Title = "LAJ HUB " .. type,
            Content = message,
            Duration = (type == "Error" and 6) or (type == "Warning" and 4) or 3,
            Image = 4483362458,
            Actions = (type == "Error") and {
                Ignore = {
                    Name = "OK",
                    Callback = function() end
                },
                Report = {
                    Name = "Copy Error",
                    Callback = function()
                        if setclipboard then
                            setclipboard("[LAJ HUB Error Report]\nVersion: " .. LAJ.Version .. "\nError: " .. message)
                            Rayfield:Notify({
                                Title = "Error Copied",
                                Content = "Error details copied to clipboard",
                                Duration = 3
                            })
                        end
                    end
                }
            } or nil
        })
    end
    
    -- Log to file system if available
    if executorFunctions.FileSystem then
        local logFile = "LAJHub_Logs.txt"
        local logContent = ""
        
        if isfile(logFile) then
            logContent = readfile(logFile)
        end
        
        local timestamp = os.date("%Y-%m-%d %H:%M:%S")
        logContent = logContent .. "[" .. timestamp .. "] [" .. type .. "] " .. message .. "\n"
        
        -- Limit log size
        if #logContent > 50000 then
            logContent = string.sub(logContent, #logContent - 50000)
        end
        
        writefile(logFile, logContent)
    end
    
    return message
end

-- Enhanced script loader with error tracking
LAJ.LoadScript = function(url, name)
    LAJ.Log("Info", "Loading " .. name .. "...")
    
    -- Add to history
    table.insert(LAJ.History, {
        Name = name,
        URL = url,
        Time = os.time()
    })
    
    -- Limit history size
    if #LAJ.History > 20 then
        table.remove(LAJ.History, 1)
    end
    
    -- Save history if file system available
    if executorFunctions.FileSystem then
        writefile("LAJHub_History.json", game:GetService("HttpService"):JSONEncode(LAJ.History))
    end
    
    -- Execute with advanced error handling (compatible with all executors)
    -- First verify script URL is valid
    if not url or url == "" then
        return LAJ.Log("Error", "Invalid script URL for " .. name)
    end
    
    -- Transform URL if needed (handle redirects, special cases)
    if string.find(url, "pastebin.com/") and not string.find(url, "pastebin.com/raw/") then
        url = string.gsub(url, "pastebin.com/", "pastebin.com/raw/")
    end
    
    -- Attempt to get script content with multiple fallback methods
    local success, result = pcall(function()
        local content
        local fetchSuccess = false
        
        -- Function to verify content is valid Lua script
        local function isValidLuaScript(str)
            if not str or type(str) ~= "string" or #str < 10 then
                return false
            end
            
            -- Basic check for valid Lua syntax markers
            return string.find(str, "function") or 
                   string.find(str, "local") or 
                   string.find(str, "if") or
                   string.find(str, "for") or
                   string.find(str, "game") or
                   string.find(str, "script")
        end
        
        -- Try different HTTP request methods across executors
        local httpMethods = {
            {name = "Synapse X", condition = syn and syn.request, fetch = function() return game:HttpGet(url) end},
            {name = "HTTP Library", condition = http and http.request, fetch = function() return game:HttpGet(url) end},
            {name = "Request", condition = request, fetch = function() return game:HttpGet(url) end},
            {name = "HttpPost", condition = HttpPost, fetch = function() return game:HttpGet(url) end},
            {name = "Fluxus", condition = fluxus and fluxus.request, fetch = function() 
                local res = fluxus.request({Url = url, Method = "GET"})
                return res.Body
            end},
            {name = "Delta", condition = delta and delta.request, fetch = function() 
                local res = delta.request({Url = url, Method = "GET"})
                return res.Body
            end},
            {name = "KRNL", condition = KRNL_LOADED, fetch = function() return game:HttpGet(url) end},
            {name = "Default HttpGet", condition = true, fetch = function() return game:HttpGet(url) end},
        }
        
        -- Attempt each HTTP method
        for _, method in ipairs(httpMethods) do
            if method.condition then
                LAJ.Log("Info", "Trying to fetch script using " .. method.name)
                local success, fetchResult = pcall(method.fetch)
                
                if success and isValidLuaScript(fetchResult) then
                    content = fetchResult
                    fetchSuccess = true
                    LAJ.Log("Success", "Script fetched successfully using " .. method.name)
                    break
                end
            end
        end
        
        -- If content fetch failed with all methods
        if not fetchSuccess or not content then
            LAJ.Log("Error", "Failed to fetch script content from " .. url)
            return error("Failed to fetch script content")
        end
        
        -- Check for script protection/encryption
        if string.find(content, "protected by") or string.find(content, "encrypted") then
            LAJ.Log("Warning", "This script appears to be protected or encrypted - execution might fail")
        end
        
        -- Attempt to execute the script
        LAJ.Log("Info", "Executing script...")
        
        -- Regular loadstring attempt
        local loadSuccess, loadError = pcall(function()
            return loadstring(content)()
        end)
        
        if not loadSuccess then
            -- If regular loadstring failed, try alternative methods based on the executor
            LAJ.Log("Warning", "Standard execution failed, trying alternative methods: " .. tostring(loadError))
            
            -- Try Synapse specific methods
            if syn and syn.load then
                return syn.load(content)
            end
            
            -- Try hookfunction or other bypass methods for protected scripts
            local env = getfenv(0)
            local func, err = load(content, name, "bt", env)
            if func then
                return func()
            else
                return error("All execution methods failed: " .. tostring(err))
            end
        end
        
        return loadSuccess
    end)
    
    if success then
        LAJ.Log("Success", name .. " was successfully executed")
        
        -- Send webhook notification when a script is executed
        local playerName = game.Players.LocalPlayer.Name
        local placeId = game.PlaceId
        local placeName = "Unknown"
        pcall(function() placeName = game:GetService("MarketplaceService"):GetProductInfo(placeId).Name end)
        
        LAJ.SendDiscordWebhook("Script executed: **" .. name .. "** by user **" .. playerName .. 
                               "** in game: " .. placeName .. " (ID: " .. placeId .. ")")
        
        return true
    else
        LAJ.Log("Error", "Failed to load " .. name .. ": " .. tostring(result))
        return false
    end
end

-- Expanded game detection system
LAJ.Games = {
    -- FPS Games
    ["Phantom Forces"] = {ID = 292439477, Category = "FPS", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/phantom-forces.lua"},
    ["Arsenal"] = {ID = 286090429, Category = "FPS", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/ArsenalOwlHub.lua"},
    ["Bad Business"] = {ID = 3233893879, Category = "FPS", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/bad-business.lua"},
    ["Strucid"] = {ID = 2377868063, Category = "FPS", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/strucid.lua"},
    ["Rush Point"] = {ID = 5993942214, Category = "FPS"},
    ["Apocalypse Rising"] = {ID = 1600503, Category = "FPS", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/ApocalypseRising.lua"},
    ["Big Paintball"] = {ID = 3527629287, Category = "FPS", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/big-paintball.lua"},
    ["Energy Assault"] = {ID = 6172932937, Category = "FPS", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/Energy%20Assault.lua"},
    ["Counter Blox"] = {ID = 301549746, Category = "FPS", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/CounterBlox.lua"},
    ["Those Who Remain"] = {ID = 488667523, Category = "FPS", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/ThoseWhoRemain.lua"},
    
    -- RPG Games
    ["Blox Fruits"] = {ID = 2753915549, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/BloxFruit.lua"},
    ["King Legacy"] = {ID = 4520749081, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/KingLegacy.lua"},
    ["Pet Simulator X"] = {ID = 6284583030, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/PetSimX.lua"},
    ["Anime Fighting Simulator"] = {ID = 4042427666, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/AnimeFighting.lua"},
    ["Shindo Life"] = {ID = 4616652839, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/ShindoLife.lua"},
    ["Your Bizarre Adventure"] = {ID = 2809202155, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/your-bizarre-adventure.lua"},
    ["Anime Dimensions"] = {ID = 6938803611, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/animedimension.lua"},
    ["Dungeon Quest"] = {ID = 2414851778, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/dungeon-quest.lua"},
    ["Slayer Tycoon"] = {ID = 7234162497, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/slayer-tycoon.lua"},
    ["Murder Mystery 2"] = {ID = 142823291, Category = "RPG", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/murder-mystery-2.lua"},
    
    -- Town & City Games
    ["Adopt Me"] = {ID = 920587237, Category = "Town & City", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/adoptme.lua"},
    ["Brookhaven"] = {ID = 4924922222, Category = "Town & City", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/brook-haven.lua"},
    ["MeepCity"] = {ID = 370731277, Category = "Town & City"},
    ["Welcome to Bloxburg"] = {ID = 185655149, Category = "Town & City", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/bloxburg.lua"},
    ["Work at a Pizza Place"] = {ID = 192800, Category = "Town & City", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/work-a-pizza-place.lua"},
    ["My Restaurant"] = {ID = 4490140733, Category = "Town & City", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/my-restaurant.lua"},
    ["Vans World"] = {ID = 6679968919, Category = "Town & City", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/vans-world.lua"},
    ["Royal High"] = {ID = 735030788, Category = "Town & City", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/royal-high.lua"},
    
    -- Fighting Games
    ["Da Hood"] = {ID = 2788229376, Category = "Fighting", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/da-hood.lua"},
    ["Hood Customs"] = {ID = 9183932460, Category = "Fighting"},
    ["Prison Life"] = {ID = 155615604, Category = "Fighting", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/prison-life.lua"},
    ["Breaking Point"] = {ID = 648362523, Category = "Fighting", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/breaking-point.lua"},
    
    -- Simulation Games
    ["Fishing Simulator"] = {ID = 2866967438, Category = "Simulation", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/FishingSim.lua"},
    ["Mining Simulator 2"] = {ID = 9551640993, Category = "Simulation"},
    ["Car Dealership Tycoon"] = {ID = 1554960397, Category = "Simulation"},
    ["Strongman Simulator"] = {ID = 5338710779, Category = "Simulation", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/strongman-simulator.lua"},
    ["Superhero Simulator"] = {ID = 2577423786, Category = "Simulation", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/superheosim.lua"},
    ["BackFlip Simulator"] = {ID = 2481601704, Category = "Simulation", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/BackFlipSim.lua"},
    ["Saber Simulator"] = {ID = 3823781113, Category = "Simulation", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/saber-simulator.lua"},
    ["Bee Swarm Simulator"] = {ID = 1537690962, Category = "Simulation", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/bee-swarm.lua"},
    ["Destruction Simulator"] = {ID = 2248408710, Category = "Simulation", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/destruction-simulator.lua"},
    ["Car Crusher"] = {ID = 13229599, Category = "Simulation", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/car-crusher.lua"},
    
    -- Adventure Games
    ["Jailbreak"] = {ID = 606849621, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/jailbreak.lua"},
    ["Mad City"] = {ID = 1224212277, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/madcity.lua"},
    ["Ninja Legends"] = {ID = 3956818381, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/ninja-legends.lua"},
    ["Tower of Hell"] = {ID = 1962086868, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/tower-of-hell.lua"},
    ["Tower of Misery"] = {ID = 4954752502, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/tower-of-misery.lua"},
    ["The Mimic"] = {ID = 6243699076, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/the-mimic.lua"},
    ["Build A Boat For Treasure"] = {ID = 537413528, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/build-a-boat-for-treasure.lua"},
    ["Shark Bite"] = {ID = 734159876, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/shark-bite.lua"},
    ["Parkour"] = {ID = 445664957, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/parkour.lua"},
    ["Speed Run 4"] = {ID = 183364845, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/speed-run-4.lua"},
    ["Piggy"] = {ID = 4623386862, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/piggy.lua"},
    ["Bedwars"] = {ID = 6872265039, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/bedwars.lua"},
    ["SkyWars"] = {ID = 855499080, Category = "Adventure", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/skywars.lua"},
    
    -- Horror Games
    ["Survive the Killer"] = {ID = 4580204640, Category = "Horror", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/survive-the-killer.lua"},
    ["Zombie Attack"] = {ID = 1240123653, Category = "Horror", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/zombie-attack.lua"},
    ["Zombie Rush"] = {ID = 137885680, Category = "Horror", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/zombie-rush.lua"},
    
    -- Tycoon Games
    ["Super Hero Tycoon"] = {ID = 574407221, Category = "Tycoon", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/super-hero-tycoon.lua"},
    
    -- Other Games
    ["Natural Disaster Survival"] = {ID = 189707, Category = "Other", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/natural-disaster-survival.lua"},
    ["Dinosaur Simulator"] = {ID = 219434352, Category = "Other", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/dinosaur-simulator.lua"},
    ["Broken Bones"] = {ID = 2551991523, Category = "Other", Script = "https://raw.githubusercontent.com/TrixAde/scripts/main/broken-bones.lua"}
}

-- Enhanced game detection system with fallbacks and error handling
LAJ.GetCurrentGame = function()
    local currentGameId = game.PlaceId
    local gameInfo = {
        Name = "Universal",
        ID = currentGameId,
        Category = "Other",
        PlaceVersion = game.PlaceVersion,
        PlaceName = "Unknown",
        Script = nil, -- Direct script URL
        IsSupported = false,
        GameIcon = "",
        PlayerCount = 0,
        Creator = "Unknown"
    }
    
    -- Try to get comprehensive game info from Roblox
    pcall(function()
        local marketplaceService = game:GetService("MarketplaceService")
        
        if marketplaceService then
            local success, result = pcall(function()
                return marketplaceService:GetProductInfo(currentGameId)
            end)
            
            if success and result then
                gameInfo.PlaceName = result.Name or "Unknown Game"
                gameInfo.Creator = result.Creator and result.Creator.Name or "Unknown"
                gameInfo.GameIcon = "rbxassetid://" .. (result.IconImageAssetId or "")
            end
        end
        
        -- Try to get player count
        pcall(function()
            gameInfo.PlayerCount = #game:GetService("Players"):GetPlayers()
        end)
    end)
    
    -- Check if game is in our database with comprehensive matching
    local matchFound = false
    for name, info in pairs(LAJ.Games) do
        -- Primary check by ID
        if currentGameId == info.ID then
            gameInfo.Name = name
            gameInfo.Category = info.Category or "Other"
            gameInfo.Script = info.Script -- Store the script URL if available
            gameInfo.IsSupported = info.Script ~= nil
            matchFound = true
            break
        end
    end
    
    -- If no match by ID, try to match by name (fuzzy match for better compatibility)
    if not matchFound and gameInfo.PlaceName ~= "Unknown" then
        for name, info in pairs(LAJ.Games) do
            if string.find(string.lower(gameInfo.PlaceName), string.lower(name), 1, true) then
                gameInfo.Name = name
                gameInfo.Category = info.Category or "Other"
                gameInfo.Script = info.Script
                gameInfo.IsSupported = info.Script ~= nil
                matchFound = true
                break
            end
        end
    end
    
    -- For games not in our database but with known categories, categorize them
    if not matchFound then
        -- Try to categorize by common game genres in the name
        local nameLower = string.lower(gameInfo.PlaceName)
        
        if string.find(nameLower, "simulator", 1, true) then
            gameInfo.Category = "Simulation"
        elseif string.find(nameLower, "tycoon", 1, true) then
            gameInfo.Category = "Tycoon"
        elseif string.find(nameLower, "obby", 1, true) or string.find(nameLower, "parkour", 1, true) then
            gameInfo.Category = "Adventure"
        elseif string.find(nameLower, "horror", 1, true) or string.find(nameLower, "scary", 1, true) then
            gameInfo.Category = "Horror"
        elseif string.find(nameLower, "rpg", 1, true) or string.find(nameLower, "role play", 1, true) or string.find(nameLower, "roleplay", 1, true) then
            gameInfo.Category = "RPG"
        elseif string.find(nameLower, "shooter", 1, true) or string.find(nameLower, "fps", 1, true) then
            gameInfo.Category = "FPS"
        end
    end
    
    -- Log game detection
    LAJ.Log("Info", "Detected game: " .. gameInfo.Name .. " (ID: " .. gameInfo.ID .. ")")
    
    -- If it's a supported game, highlight this to the user
    if gameInfo.IsSupported then
        LAJ.Log("Success", "This game has a dedicated script available!")
    end
    
    return gameInfo
end

-- Enhanced settings management
LAJ.LoadSettings = function()
    if executorFunctions.FileSystem and isfile("LAJHub_Settings.json") then
        local success, result = pcall(function()
            return game:GetService("HttpService"):JSONDecode(readfile("LAJHub_Settings.json"))
        end)
        
        if success and type(result) == "table" then
            LAJ.Log("Info", "Settings loaded successfully")
            return result
        else
            LAJ.Log("Warning", "Failed to load settings, using defaults")
        end
    end
    
    return {
        Theme = "Default",
        AutoExecute = {},
        UIScale = 1,
        Favorites = {},
        RecentScripts = {},
        CustomScripts = {}
    }
end

LAJ.SaveSettings = function()
    if executorFunctions.FileSystem then
        local success, result = pcall(function()
            writefile("LAJHub_Settings.json", game:GetService("HttpService"):JSONEncode(LAJ.Config))
            return true
        end)
        
        if success then
            LAJ.Log("Success", "Settings saved successfully")
            return true
        else
            LAJ.Log("Error", "Failed to save settings: " .. tostring(result))
            return false
        end
    end
    return false
end

-- Initialize settings
LAJ.Config = LAJ.LoadSettings()

-- Validate all game script URLs to ensure they're working
LAJ.ValidateGameScripts = function()
    LAJ.Log("Info", "Validating game script URLs...")
    local validatedCount = 0
    local invalidCount = 0
    local attempts = 0
    
    -- Function to check if a URL is valid
    local function isUrlValid(url)
        if not url or url == "" then
            return false
        end
        
        -- Try to fetch the URL without executing it
        local success = pcall(function()
            if syn and syn.request then
                local response = syn.request({
                    Url = url,
                    Method = "HEAD"
                })
                return response.StatusCode == 200
            else
                -- Fallback to a quick GET request
                local content = game:HttpGet(url)
                return content and #content > 0
            end
        end)
        
        return success
    end
    
    -- Check scripts for all games
    for gameName, gameInfo in pairs(LAJ.Games) do
        attempts = attempts + 1
        
        -- Only check 10 random scripts to avoid excessive requests
        if attempts > 10 and math.random() > 0.2 then
            continue
        end
        
        if gameInfo.Script and isUrlValid(gameInfo.Script) then
            validatedCount = validatedCount + 1
        else
            invalidCount = invalidCount + 1
            LAJ.Log("Warning", "Script URL for " .. gameName .. " appears to be invalid")
            
            -- Try to fix common URL issues
            if gameInfo.Script then
                local originalUrl = gameInfo.Script
                local fixedUrl = gameInfo.Script
                
                -- Fix common URL issues
                fixedUrl = fixedUrl:gsub("githubusercontent.com/([^/]+)/([^/]+)/main", "githubusercontent.com/%1/%2/master")
                
                -- If URL was fixed, update it
                if fixedUrl ~= originalUrl then
                    LAJ.Log("Info", "Attempting to fix URL for " .. gameName)
                    gameInfo.Script = fixedUrl
                    
                    -- Check if fixed URL works
                    if isUrlValid(fixedUrl) then
                        LAJ.Log("Success", "Fixed script URL for " .. gameName)
                        validatedCount = validatedCount + 1
                        invalidCount = invalidCount - 1
                    end
                end
            end
        end
    end
    
    -- Log results
    LAJ.Log("Info", "URL validation complete: " .. validatedCount .. " valid, " .. invalidCount .. " potentially invalid scripts")
end

-- Test for alternative script sources if the main source fails
LAJ.GetAlternativeScript = function(gameName)
    if not gameName then return nil end
    
    -- Common alternative script sources for popular games
    local altSources = {
        ["Blox Fruits"] = {
            "https://raw.githubusercontent.com/xDepressionx/Free-Script/main/BloxFruit.lua",
            "https://raw.githubusercontent.com/scriptpastebin/raw/main/BloxFruit"
        },
        ["Arsenal"] = {
            "https://raw.githubusercontent.com/RandomAdamYT/DarkHub/master/Init",
            "https://raw.githubusercontent.com/fusiongreg/BoltsHubV5/main/Arsenal"
        },
        ["Adopt Me"] = {
            "https://raw.githubusercontent.com/IceMael7/NewIceHub/main/Brookhaven",
            "https://raw.githubusercontent.com/IceMael7/IceHub_MM2/main/Main"
        },
        ["Phantom Forces"] = {
            "https://raw.githubusercontent.com/VoidMasterX/strawhook/main/script.lua",
            "https://raw.githubusercontent.com/VoidMasterX/scripts/main/phantom-forces.lua"
        }
    }
    
    -- Return the alternative scripts if they exist
    if altSources[gameName] then
        return altSources[gameName]
    end
    
    -- Alternative by game category
    local gameInfo = nil
    for name, info in pairs(LAJ.Games) do
        if name == gameName then
            gameInfo = info
            break
        end
    end
    
    if not gameInfo or not gameInfo.Category then
        return nil
    end
    
    -- Generic alternative scripts by category
    local catSources = {
        ["FPS"] = {
            "https://raw.githubusercontent.com/VoidMasterX/strawhook/main/script.lua",
            "https://raw.githubusercontent.com/RandomAdamYT/DarkHub/master/Init"
        },
        ["RPG"] = {
            "https://raw.githubusercontent.com/xDepressionx/Free-Script/main/AllScript.lua",
            "https://raw.githubusercontent.com/scriptpastebin/raw/main/Universal"
        }
    }
    
    return catSources[gameInfo.Category]
end

-- Send webhook notification on script initialization
local playerName = game.Players.LocalPlayer.Name
local placeId = game.PlaceId
local placeName = "Unknown"
pcall(function() placeName = game:GetService("MarketplaceService"):GetProductInfo(placeId).Name end)

-- Send webhook with user info
LAJ.SendDiscordWebhook("LAJ HUB " .. LAJ.Version .. " was executed by **" .. playerName .. 
                       "** in game: " .. placeName .. " (ID: " .. placeId .. ")")

-- Validate game scripts in the background
spawn(function()
    LAJ.ValidateGameScripts()
end)

-- Set up favorites system
LAJ.IsFavorite = function(scriptName)
    for _, fav in ipairs(LAJ.Config.Favorites or {}) do
        if fav.Name == scriptName then
            return true
        end
    end
    return false
end

LAJ.ToggleFavorite = function(scriptName, scriptUrl)
    LAJ.Config.Favorites = LAJ.Config.Favorites or {}
    
    for i, fav in ipairs(LAJ.Config.Favorites) do
        if fav.Name == scriptName then
            table.remove(LAJ.Config.Favorites, i)
            LAJ.SaveSettings()
            LAJ.Log("Info", "Removed " .. scriptName .. " from favorites")
            return false
        end
    end
    
    table.insert(LAJ.Config.Favorites, {
        Name = scriptName,
        URL = scriptUrl,
        AddedAt = os.time()
    })
    
    LAJ.SaveSettings()
    LAJ.Log("Success", "Added " .. scriptName .. " to favorites")
    return true
end

-- Create enhanced window with modern design inspired by Orion UI
local Window = Rayfield:CreateWindow({
    Name = "LAJ HUB " .. LAJ.Version,
    LoadingTitle = "LAJ HUB " .. LAJ.Version,
    LoadingSubtitle = "by LAJ Development Team",
    LoadingIcon = "rbxassetid://10618644218", -- Modern loading icon
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "LAJHub",
        FileName = "Configuration"
    },
    Discord = {
        Enabled = true,
        Invite = "4mgdcfvAJU",
        RememberJoins = true
    },
    KeySystem = true,
    KeySettings = {
        Title = "LAJ HUB " .. LAJ.Version .. " | PREMIUM",
        Subtitle = "Premium Key Authentication",
        Note = "Enter the key: LAJPRO\n\nNeed a key? Join our Discord server for keys!\nWe'll copy the Discord link to your clipboard if you enter the wrong key.",
        FileName = "LAJHubKey",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {
            "LAJPRO" -- Only key
        },
        WrongKeyCallback = function()
            -- Copy the Discord link to the user's clipboard when they enter the wrong key
            if setclipboard then
                setclipboard("https://discord.gg/4mgdcfvAJU")
                Rayfield:Notify({
                    Title = "Discord Link Copied!",
                    Content = "We've copied our Discord invite to your clipboard. Join us to get your free key!",
                    Duration = 5,
                    Image = 6031075927, -- Discord icon
                })
            else
                Rayfield:Notify({
                    Title = "Join Our Discord!",
                    Content = "Join our Discord server at https://discord.gg/4mgdcfvAJU to get your free key!",
                    Duration = 5,
                    Image = 6031075927, -- Discord icon
                })
            end
            return "Discord link has been copied to your clipboard. Join our server to get your key!"
        }
    },
    Theme = LAJ.Config.Theme or "Midnight", -- Sleek dark theme
    UIColor = Color3.fromRGB(49, 100, 231) -- Modern blue accent color
})

-- Create main UI tabs with improved icons
local gameInfo = LAJ.GetCurrentGame()

-- Dashboard Tab (Home icon)
local DashboardTab = Window:CreateTab("Dashboard", 6026568198)
-- Player Tab (Character icon)
local PlayerTab = Window:CreateTab("Player", 6034287522)
-- Universal Tab (Globe icon)
local UniversalTab = Window:CreateTab("Universal", 6031280882)
-- Games Tab (Controller icon)
local GamesTab = Window:CreateTab("Games", 6031763426)
-- Favorites Tab (Heart icon)
local FavoritesTab = Window:CreateTab("Favorites", 6034509993)
-- GitHub Tab (Code icon)
local GitHubTab = Window:CreateTab("GitHub", 6022668888)
-- Settings Tab (Gear icon)
local SettingsTab = Window:CreateTab("Settings", 6031280882)

-- Dashboard Content
DashboardTab:CreateSection("🌟 Welcome to LAJ HUB " .. LAJ.Version)

local gameInfoLabel = DashboardTab:CreateLabel("🎮 Current Game: " .. gameInfo.Name .. " (" .. gameInfo.ID .. ")")
local versionLabel = DashboardTab:CreateLabel("📊 Version: " .. LAJ.Version)

DashboardTab:CreateParagraph({
    Title = "LAJ HUB - The Ultimate Exploit Hub",
    Content = "LAJ HUB " .. LAJ.Version .. " provides the best Roblox exploits organized by game categories and types. Navigate through the tabs to find scripts for your favorite games or use universal exploits that work across Roblox."
})

-- Game-specific recommendations
if gameInfo.Name ~= "Universal" then
    DashboardTab:CreateSection("📋 Recommendations for " .. gameInfo.Name)
    
    -- Add button to directly execute TrixAde script if available
    if gameInfo.Script then
        DashboardTab:CreateButton({
            Name = "⚡ Execute TrixAde Script for " .. gameInfo.Name,
            Info = "Run the most compatible TrixAde script for " .. gameInfo.Name,
            Callback = function()
                LAJ.Log("Info", "Executing TrixAde script for " .. gameInfo.Name)
                LAJ.LoadScript(gameInfo.Script, gameInfo.Name .. " (TrixAde)")
            end,
        })
    end
    
    DashboardTab:CreateButton({
        Name = "🚀 Load All Scripts for " .. gameInfo.Name,
        Info = "Quick access to all scripts for " .. gameInfo.Name,
        Callback = function()
            LAJ.Log("Info", "Loading recommended scripts for " .. gameInfo.Name)
            GamesTab:Select()
            
            -- Finding the appropriate game category
            for i, v in pairs(LAJ.Games) do
                if i == gameInfo.Name then
                    -- We would automatically highlight or scroll to the correct section
                    -- but Rayfield doesn't support this directly
                    LAJ.Log("Info", "Found " .. gameInfo.Name .. " in category " .. v.Category)
                    break
                end
            end
        end,
    })
end

-- Recent activity section
DashboardTab:CreateSection("📜 Recent Activity")

-- This would be dynamically populated with recent scripts executed
if #LAJ.History > 0 then
    for i = 1, math.min(5, #LAJ.History) do
        local item = LAJ.History[#LAJ.History - (i-1)]
        DashboardTab:CreateButton({
            Name = item.Name,
            Info = "Re-execute this script",
            Callback = function()
                LAJ.LoadScript(item.URL, item.Name)
            end,
        })
    end
else
    DashboardTab:CreateLabel("No recent activity")
end

-- Discord & Community
DashboardTab:CreateSection("🌐 Community")

DashboardTab:CreateButton({
    Name = "🔗 Join Discord",
    Info = "Join our community for updates and support",
    Callback = function()
        if setclipboard then
            setclipboard("https://discord.gg/4mgdcfvAJU")
            LAJ.Log("Info", "Discord invite copied to clipboard")
        else
            LAJ.Log("Warning", "Clipboard function not available")
        end
    end,
})

-- Player Tab
PlayerTab:CreateSection("🧍 Player Utilities")

-- ESP Features
local espEnabled = false
PlayerTab:CreateToggle({
    Name = "🔍 ESP / Wallhack",
    Info = "See players through walls",
    CurrentValue = false,
    Flag = "ESPEnabled",
    Callback = function(Value)
        espEnabled = Value
        if Value then
            LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/espwallhack", "ESP Wallhack")
        else
            LAJ.Log("Info", "ESP disabled - rejoin to fully remove")
        end
    end,
})

-- Teleport utilities
PlayerTab:CreateSection("🏃 Movement & Teleport")

PlayerTab:CreateToggle({
    Name = "🏎️ Speed Boost",
    Info = "Increase character's movement speed",
    CurrentValue = false,
    Flag = "SpeedBoostEnabled",
    Callback = function(Value)
        -- Speed boost code
        if Value then
            local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                LAJ.Cache.OriginalWalkSpeed = humanoid.WalkSpeed
                humanoid.WalkSpeed = 50
                LAJ.Log("Info", "Speed boost enabled")
            else
                LAJ.Log("Error", "Humanoid not found")
            end
        else
            local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and LAJ.Cache.OriginalWalkSpeed then
                humanoid.WalkSpeed = LAJ.Cache.OriginalWalkSpeed
                LAJ.Log("Info", "Speed boost disabled")
            end
        end
    end,
})

PlayerTab:CreateToggle({
    Name = "🦘 Jump Power",
    Info = "Increase character's jump height",
    CurrentValue = false,
    Flag = "JumpPowerEnabled",
    Callback = function(Value)
        -- Jump power code
        if Value then
            local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                LAJ.Cache.OriginalJumpPower = humanoid.JumpPower
                humanoid.JumpPower = 100
                LAJ.Log("Info", "Jump power enhanced")
            else
                LAJ.Log("Error", "Humanoid not found")
            end
        else
            local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and LAJ.Cache.OriginalJumpPower then
                humanoid.JumpPower = LAJ.Cache.OriginalJumpPower
                LAJ.Log("Info", "Jump power reset")
            end
        end
    end,
})

PlayerTab:CreateToggle({
    Name = "🦅 Fly (Risk)",
    Info = "Makes your character fly (High ban risk)",
    CurrentValue = false,
    Flag = "FlyEnabled",
    Callback = function(Value)
        if Value then
            LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/fly", "Fly Script")
        else
            LAJ.Log("Info", "Fly disabled - rejoin to fully remove")
        end
    end,
})

-- Universal Scripts Tab
UniversalTab:CreateSection("🌍 Universal Admin Scripts")

UniversalTab:CreateButton({
    Name = "⌨️ Infinite Yield",
    Info = "Admin commands script",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", "Infinite Yield")
    end,
})

UniversalTab:CreateButton({
    Name = "🛠️ Domain X",
    Info = "Advanced admin commands",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/shlexware/DomainX/main/source", "Domain X")
    end,
})

UniversalTab:CreateButton({
    Name = "⚙️ CMD-X Admin",
    Info = "Comprehensive admin command system",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/CMD-X/CMD-X/master/Source", "CMD-X Admin")
    end,
})

-- Universal utilities section
UniversalTab:CreateSection("🔧 Universal Utilities")

UniversalTab:CreateButton({
    Name = "🎯 Aimbot",
    Info = "Universal aimbot script",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/aimbot", "Universal Aimbot")
    end,
})

UniversalTab:CreateButton({
    Name = "👁️ Universal ESP",
    Info = "ESP that works across games",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/esp", "Universal ESP")
    end,
})

UniversalTab:CreateButton({
    Name = "🔍 Remote Spy",
    Info = "Monitor remote events and functions",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/remotespy", "Remote Spy")
    end,
})

-- Da Strike Section (retained from original)
UniversalTab:CreateSection("⚔️ Da Strike")

UniversalTab:CreateButton({
    Name = "📜 Psalm",
    Info = "Da Strike exploit script",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/NewWhitelistService/l/refs/heads/main/psalms%20old.lua", "Psalm")
    end,
})

UniversalTab:CreateButton({
    Name = "🔮 Ballware VFS",
    Info = "Advanced Da Strike script",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/DHBCommunity/DHBOfficialScript/refs/heads/main/Protected_4021809531880627.txt", "Ballware VFS")
    end,
})

UniversalTab:CreateButton({
    Name = "❄️ FrostByte",
    Info = "Premium Da Strike exploit",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/Totocoems/Frostbyte-/main/Frostbyte%20leak", "FrostByte")
    end,
})

-- Fishing Scripts Section (retained from original)
UniversalTab:CreateSection("🎣 Fishing")

UniversalTab:CreateButton({
    Name = "🎮 Ronix",
    Info = "Fishing game exploit",
    Callback = function()
        LAJ.LoadScript("https://api.luarmor.net/files/v3/loaders/a3c501e721ec4d66a864cc2276c0f4e9.lua", "Ronix")
    end,
})

UniversalTab:CreateButton({
    Name = "⚡ Speed Hub",
    Info = "Speed Hub X fishing scripts",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua", "Speed Hub")
    end,
})

-- Games Tab (Replaces the old PopularTab)
-- Organize by game categories
GamesTab:CreateSection("🔍 Game Script Search")

-- Game search functionality
local gameSearchInput = GamesTab:CreateInput({
    Name = "🔎 Search Games",
    Info = "Enter game name to find scripts",
    PlaceholderText = "Example: Arsenal, Blox Fruits...",
    Flag = "GameSearchInput",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        -- Simple search logic (would be more advanced in a real implementation)
        local searchText = string.lower(Text)
        for gameName, gameData in pairs(LAJ.Games) do
            if string.find(string.lower(gameName), searchText) then
                LAJ.Log("Info", "Found matching game: " .. gameName)
                -- This would ideally scroll to that section, but we'd need to implement that
            end
        end
    end,
})

-- Add TrixAde collection section
GamesTab:CreateSection("🌟 TrixAde Scripts Collection")

-- Add explanation about TrixAde scripts
GamesTab:CreateParagraph({
    Title = "TrixAde Script Collection",
    Content = "Below you'll find a comprehensive collection of scripts from TrixAde, one of the most respected script developers in the Roblox community. These scripts are maintained regularly and provide powerful exploits for a wide variety of popular games."
})

-- Create dynamic buttons for all games with TrixAde scripts
local trixGameCount = 0
for gameName, gameData in pairs(LAJ.Games) do
    if gameData.Script then
        trixGameCount = trixGameCount + 1
        
        GamesTab:CreateButton({
            Name = "⚡ " .. gameName,
            Info = "TrixAde script for " .. gameName,
            Callback = function()
                LAJ.LoadScript(gameData.Script, gameName .. " (TrixAde)")
            end,
        })
        
        -- Create groups of 5 games to avoid cluttering the UI
        if trixGameCount % 5 == 0 then
            GamesTab:CreateParagraph({
                Title = "",
                Content = "─────────────────────────────"
            })
        end
    end
end

-- FPS Games Category
GamesTab:CreateSection("🎯 FPS Games")

-- Arsenal
GamesTab:CreateParagraph({
    Title = "Arsenal",
    Content = "Competitive first-person shooter game where players eliminate opponents with various weapons to earn points and win rounds.",
})

GamesTab:CreateButton({
    Name = "🔫 Dark Hub",
    Info = "Advanced aimbot, ESP, and more for Arsenal",
    Callback = function()
        LAJ.LoadScript("https://darkhub.xyz/remote-script.lua", "Dark Hub")
    end,
})

GamesTab:CreateButton({
    Name = "🦉 Owl Hub",
    Info = "Universal FPS script compatible with Arsenal",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/CriShoux/OwlHub/master/OwlHub.txt", "Owl Hub")
    end,
})

GamesTab:CreateButton({
    Name = "🎯 Arsenal Aimbot Pro",
    Info = "Premium Arsenal aimbot with wallhack",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/arsenal", "Arsenal Aimbot Pro")
    end,
})

-- Add favorite button with dynamic state
local arsenalFavBtn = GamesTab:CreateButton({
    Name = LAJ.IsFavorite("Arsenal Scripts") and "⭐ Remove from Favorites" or "☆ Add to Favorites",
    Info = "Toggle favorite status for Arsenal scripts",
    Callback = function()
        local isFav = LAJ.ToggleFavorite("Arsenal Scripts", "CATEGORY:Arsenal")
        arsenalFavBtn:Set({
            Name = isFav and "⭐ Remove from Favorites" or "☆ Add to Favorites"
        })
    end,
})

-- Phantom Forces
GamesTab:CreateParagraph({
    Title = "Phantom Forces",
    Content = "Tactical first-person shooter with advanced weapon mechanics and multiple gameplay modes.",
})

GamesTab:CreateButton({
    Name = "🎯 Strucid Silent Aim",
    Info = "Silent aim and ESP for Phantom Forces",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/VoidMasterX/strawhook/main/script.lua", "Strucid Silent Aim")
    end,
})

GamesTab:CreateButton({
    Name = "🎮 GOODWILL",
    Info = "Advanced combat suite for Phantom Forces",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/Stefanuk12/ROBLOX/master/Games/Phantom%20Forces/GOODWILL", "GOODWILL")
    end,
})

-- RPG Games Category
GamesTab:CreateSection("⚔️ RPG Games")

-- Blox Fruits
GamesTab:CreateParagraph({
    Title = "Blox Fruits",
    Content = "One Piece inspired game where players collect fruits, fight bosses, and gain power through various means.",
})

GamesTab:CreateButton({
    Name = "🍎 Mukuro Hub",
    Info = "Complete Blox Fruits exploit suite",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/xQuartyx/DonateMe/main/ScriptLoader", "Mukuro Hub")
    end,
})

GamesTab:CreateButton({
    Name = "⚡ Ripper Hub",
    Info = "Auto-farm and combat scripts for Blox Fruits",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/hajibeza/RIPPER-HUB/main/BF.lua", "Ripper Hub")
    end,
})

GamesTab:CreateButton({
    Name = "🎭 Hoho Hub",
    Info = "Premium Blox Fruits features and automation",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/acsu123/HOHO_H/main/Loading_UI", "Hoho Hub")
    end,
})

-- Fighting Games Category
GamesTab:CreateSection("👊 Fighting Games")

-- Da Hood
GamesTab:CreateParagraph({
    Title = "Da Hood",
    Content = "Urban roleplaying game focused on streetfighting, robberies, and territory control.",
})

GamesTab:CreateButton({
    Name = "🌀 Vortex Hub",
    Info = "All-in-one Da Hood script",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/ImagineProxy/vortex/main/main", "Vortex Hub")
    end,
})

GamesTab:CreateButton({
    Name = "🔫 Ray X",
    Info = "Silent aim and combat for Da Hood",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/SpaceYes/Lua/Main/DaHood.Lua", "Ray X")
    end,
})

GamesTab:CreateButton({
    Name = "😎 Swag Mode",
    Info = "Popular Da Hood script with premium features",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/lerkermer/lua-projects/master/SwagModeV002", "Swag Mode")
    end,
})

-- Simulation Games
GamesTab:CreateSection("🌎 Simulation Games")

-- Fishing Simulator
GamesTab:CreateParagraph({
    Title = "Fishing Simulator",
    Content = "Catch fish, upgrade equipment, and explore the world in this relaxing simulator game.",
})

GamesTab:CreateButton({
    Name = "🎮 Ronix",
    Info = "Auto-fishing and item collection",
    Callback = function()
        LAJ.LoadScript("https://api.luarmor.net/files/v3/loaders/a3c501e721ec4d66a864cc2276c0f4e9.lua", "Ronix")
    end,
})

GamesTab:CreateButton({
    Name = "⚡ Speed Hub",
    Info = "Multi-game hub with Fishing Simulator support",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua", "Speed Hub")
    end,
})

-- Favorites Tab
FavoritesTab:CreateSection("⭐ Your Favorite Scripts")

if LAJ.Config.Favorites and #LAJ.Config.Favorites > 0 then
    for _, fav in ipairs(LAJ.Config.Favorites) do
        -- Check if it's a category or direct script
        if string.sub(fav.URL, 1, 9) == "CATEGORY:" then
            -- It's a category favorite
            local categoryName = string.sub(fav.URL, 10)
            FavoritesTab:CreateParagraph({
                Title = "🔖 " .. fav.Name,
                Content = "Category: " .. categoryName .. "\nAdded: " .. os.date("%Y-%m-%d", fav.AddedAt)
            })
            
            FavoritesTab:CreateButton({
                Name = "🔄 Go to Category",
                Info = "Navigate to this game category",
                Callback = function()
                    GamesTab:Select()
                    LAJ.Log("Info", "Navigated to " .. categoryName .. " category")
                end,
            })
        else
            -- It's a direct script favorite
            FavoritesTab:CreateButton({
                Name = "⚡ " .. fav.Name,
                Info = "Execute this favorite script",
                Callback = function()
                    LAJ.LoadScript(fav.URL, fav.Name)
                end,
            })
        end
        
        -- Add remove from favorites button
        FavoritesTab:CreateButton({
            Name = "❌ Remove from Favorites",
            Info = "Remove " .. fav.Name .. " from favorites",
            Callback = function()
                LAJ.ToggleFavorite(fav.Name, fav.URL)
                -- This would ideally refresh the UI, but we'd need to implement that
                LAJ.Log("Info", "Removed " .. fav.Name .. " from favorites. Restart to see changes.")
            end,
        })
    end
else
    FavoritesTab:CreateLabel("No favorites added yet")
    FavoritesTab:CreateParagraph({
        Title = "How to Add Favorites",
        Content = "Look for the '☆ Add to Favorites' buttons throughout the hub to add scripts to your favorites list for quick access."
    })
end

-- GitHub Tab
GitHubTab:CreateSection("🧩 GitHub Script Repository")

GitHubTab:CreateParagraph({
    Title = "GitHub Scripts Integration",
    Content = "Load scripts directly from GitHub repositories. These scripts are maintained by the community and offer cutting-edge exploits for a variety of Roblox games."
})

-- Custom GitHub loader
local repoOwnerInput
local repoNameInput
local scriptPathInput

GitHubTab:CreateSection("🔗 Custom GitHub Script Loader")

repoOwnerInput = GitHubTab:CreateInput({
    Name = "👤 Repository Owner",
    Info = "Enter the GitHub username of the repository owner",
    PlaceholderText = "Example: xHeptc",
    Flag = "RepoOwnerInput",
    RemoveTextAfterFocusLost = false
})

repoNameInput = GitHubTab:CreateInput({
    Name = "📁 Repository Name",
    Info = "Enter the name of the GitHub repository",
    PlaceholderText = "Example: Kavo-UI-Library",
    Flag = "RepoNameInput",
    RemoveTextAfterFocusLost = false
})

scriptPathInput = GitHubTab:CreateInput({
    Name = "📄 Script Path",
    Info = "Enter the path to the Lua script file in the repository",
    PlaceholderText = "Example: main.lua or folder/script.lua",
    Flag = "ScriptPathInput",
    RemoveTextAfterFocusLost = false
})

GitHubTab:CreateButton({
    Name = "🚀 Load GitHub Script",
    Info = "Attempt to load the script from the specified GitHub repository",
    Callback = function()
        local owner = repoOwnerInput.GetText()
        local repo = repoNameInput.GetText()
        local path = scriptPathInput.GetText()
        
        if owner == "" or repo == "" or path == "" then
            LAJ.Log("Error", "Please fill in all GitHub repository fields")
            return
        end
        
        -- Construct GitHub raw URL
        local url = string.format("https://raw.githubusercontent.com/%s/%s/main/%s", owner, repo, path)
        local scriptName = string.format("%s/%s", repo, path)
        
        LAJ.Log("Info", "Attempting to load GitHub script: " .. url)
        LAJ.LoadScript(url, scriptName)
    end
})

-- Popular GitHub Script Hubs
GitHubTab:CreateSection("⭐ Popular GitHub Script Hubs")

-- Admin Hubs
GitHubTab:CreateParagraph({
    Title = "Admin Command Scripts",
    Content = "Powerful admin command scripts from top GitHub repositories."
})

GitHubTab:CreateButton({
    Name = "⚡ Infinite Yield FE",
    Info = "One of the most comprehensive admin scripts",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", "Infinite Yield FE")
    end
})

GitHubTab:CreateButton({
    Name = "🔥 CMD-X Admin",
    Info = "Extensive admin commands with custom UI",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/CMD-X/CMD-X/master/Source", "CMD-X Admin")
    end
})

-- UI Libraries
GitHubTab:CreateParagraph({
    Title = "UI Libraries",
    Content = "High-quality UI libraries for creating your own script GUIs."
})

GitHubTab:CreateButton({
    Name = "🎨 Rayfield UI Library",
    Info = "The UI library used in this hub",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/shlexware/Rayfield/main/source", "Rayfield UI Library")
    end
})

GitHubTab:CreateButton({
    Name = "🎯 Orion UI Library",
    Info = "Modern UI library with sleek design",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/shlexware/Orion/main/source", "Orion UI Library")
    end
})

-- Game-specific GitHub repositories
GitHubTab:CreateSection("🎮 Game-Specific GitHub Scripts")

GitHubTab:CreateParagraph({
    Title = "Blox Fruits GitHub Scripts",
    Content = "Premium scripts for Blox Fruits from top GitHub repositories."
})

GitHubTab:CreateButton({
    Name = "🍎 Table Hub (Blox Fruits)",
    Info = "Premium auto-farm for Blox Fruits",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/Table-Hub/T-HUB/main/TableHubv.010", "Table Hub")
    end
})

GitHubTab:CreateButton({
    Name = "🌴 NevaHub (Blox Fruits)",
    Info = "Advanced features for Blox Fruits",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/VEZ2/NEVAHUB/main/2", "NevaHub")
    end
})

GitHubTab:CreateParagraph({
    Title = "Arsenal GitHub Scripts",
    Content = "Top-tier scripts for Arsenal from GitHub repositories."
})

GitHubTab:CreateButton({
    Name = "🔫 Bolts Hub V5 (Arsenal)",
    Info = "Premium Arsenal script with aimbot and ESP",
    Callback = function()
        LAJ.LoadScript("https://raw.githubusercontent.com/fusiongreg/BoltsHubV5/main/Main", "Bolts Hub V5")
    end
})

-- Add repository creation section
GitHubTab:CreateSection("🌟 Create Your Own Script Repository")

GitHubTab:CreateParagraph({
    Title = "Host Your Own Scripts",
    Content = "Want to host your own scripts on GitHub? Follow these steps:\n1. Create a GitHub account\n2. Create a new repository\n3. Upload your Lua scripts\n4. Use the Custom GitHub Script Loader above to load your scripts"
})

GitHubTab:CreateButton({
    Name = "📋 Copy Repository Template URL",
    Info = "Copy a template URL for creating your own script repository",
    Callback = function()
        if setclipboard then
            setclipboard("https://github.com/new")
            LAJ.Log("Info", "GitHub new repository URL copied to clipboard")
        else
            LAJ.Log("Warning", "Clipboard function not available")
        end
    end
})

-- Premium Scripts Tab
local premiumScripts = {
    {
        Name = "🤖 LAJ Auto Farm Suite",
        Info = "Comprehensive automation for multiple games",
        URL = "https://raw.githubusercontent.com/LAJHubPremium/scripts/main/autofarm"
    },
    {
        Name = "🎯 LAJ Silent Aim (Universal)",
        Info = "Advanced targeting system that works in most games",
        URL = "https://raw.githubusercontent.com/LAJHubPremium/scripts/main/silentaim"
    },
    {
        Name = "👁️ LAJ ESP & Wallhack Pro",
        Info = "Premium ESP with advanced features",
        URL = "https://raw.githubusercontent.com/LAJHubPremium/scripts/main/espwallhack"
    },
    {
        Name = "⚡ LAJ Teleport Suite",
        Info = "Advanced teleportation with waypoints",
        URL = "https://raw.githubusercontent.com/LAJHubPremium/scripts/main/teleport"
    },
    {
        Name = "💰 LAJ Money Maker",
        Info = "Currency exploits for supported games",
        URL = "https://raw.githubusercontent.com/LAJHubPremium/scripts/main/moneymaker"
    },
    {
        Name = "🔓 LAJ Unlock All",
        Info = "Unlock items, weapons, and cosmetics",
        URL = "https://raw.githubusercontent.com/LAJHubPremium/scripts/main/unlocker"
    },
    {
        Name = "🔧 LAJ Server Crasher",
        Info = "High-risk utility to crash servers (use with caution)",
        URL = "https://raw.githubusercontent.com/LAJHubPremium/scripts/main/servercrash"
    }
}

-- PremiumTab is already defined above, so we don't need to create it again
PremiumTab:CreateSection("💎 Premium Scripts")

PremiumTab:CreateParagraph({
    Title = "Premium LAJ HUB Access",
    Content = "These exclusive scripts are only available to LAJ HUB ULTRA members. They offer advanced features, regular updates, and detection bypasses for a safer exploiting experience."
})

for _, script in ipairs(premiumScripts) do
    PremiumTab:CreateButton({
        Name = script.Name,
        Info = script.Info,
        Callback = function()
            LAJ.LoadScript(script.URL, string.sub(script.Name, 4)) -- Remove emoji from name
        end,
    })
end

-- Settings Tab
SettingsTab:CreateSection("⚙️ Interface Settings")

-- Theme Selector
local ThemeDropdown = SettingsTab:CreateDropdown({
    Name = "🎨 Theme",
    Options = {"Default", "Light", "Dark", "Midnight", "Sentinel", "Synapse"},
    CurrentOption = LAJ.Config.Theme or "Default",
    Flag = "ThemeOption",
    Callback = function(Value)
        LAJ.Config.Theme = Value
        LAJ.SaveSettings()
        LAJ.Log("Success", "Theme changed to " .. Value .. ". Restart to apply.")
    end,
})

-- UI Scale
SettingsTab:CreateSlider({
    Name = "📏 UI Scale",
    Range = {0.5, 1.5},
    Increment = 0.1,
    Suffix = "x",
    CurrentValue = LAJ.Config.UIScale or 1,
    Flag = "UIScaleSlider",
    Callback = function(Value)
        LAJ.Config.UIScale = Value
        LAJ.SaveSettings()
        -- Scale would be applied if Rayfield supported it
        LAJ.Log("Info", "UI Scale set to " .. Value .. "x")
    end,
})

-- Auto Execute Settings
SettingsTab:CreateSection("🔄 Auto Execute")

-- List of scripts that can be auto-executed
local autoExecuteScripts = {
    "Infinite Yield",
    "ESP",
    "Silent Aim",
    "FPS Booster",
    "Anti-AFK"
}

for _, scriptName in ipairs(autoExecuteScripts) do
    SettingsTab:CreateToggle({
        Name = "Auto Execute " .. scriptName,
        CurrentValue = LAJ.Config.AutoExecute and LAJ.Config.AutoExecute[scriptName] or false,
        Flag = "AutoExecute" .. scriptName:gsub(" ", ""),
        Callback = function(Value)
            LAJ.Config.AutoExecute = LAJ.Config.AutoExecute or {}
            LAJ.Config.AutoExecute[scriptName] = Value
            LAJ.SaveSettings()
            LAJ.Log("Info", "Auto Execute for " .. scriptName .. " set to " .. tostring(Value))
        end,
    })
end

-- Advanced Settings
SettingsTab:CreateSection("⚠️ Advanced Settings")

SettingsTab:CreateToggle({
    Name = "🔒 Safe Mode",
    Info = "Adds extra protection against detection",
    CurrentValue = LAJ.Config.SafeMode or true,
    Flag = "SafeMode",
    Callback = function(Value)
        LAJ.Config.SafeMode = Value
        LAJ.SaveSettings()
        LAJ.Log("Info", "Safe Mode set to " .. tostring(Value))
    end,
})

SettingsTab:CreateToggle({
    Name = "📝 Debug Logging",
    Info = "Save detailed logs for troubleshooting",
    CurrentValue = LAJ.Config.DebugLogging or false,
    Flag = "DebugLogging",
    Callback = function(Value)
        LAJ.Config.DebugLogging = Value
        LAJ.SaveSettings()
        LAJ.Log("Info", "Debug Logging set to " .. tostring(Value))
    end,
})

SettingsTab:CreateButton({
    Name = "🗑️ Clear Settings",
    Info = "Reset all settings to default",
    Callback = function()
        -- Confirm first
        Rayfield:Notify({
            Title = "Confirm Reset",
            Content = "Are you sure you want to reset all settings?",
            Duration = 10,
            Actions = {
                Confirm = {
                    Name = "Yes",
                    Callback = function()
                        LAJ.Config = {
                            Theme = "Default",
                            AutoExecute = {},
                            UIScale = 1,
                            Favorites = {},
                            SafeMode = true,
                            DebugLogging = false
                        }
                        LAJ.SaveSettings()
                        LAJ.Log("Success", "Settings reset to default")
                    end
                },
                Cancel = {
                    Name = "No",
                    Callback = function()
                        LAJ.Log("Info", "Settings reset cancelled")
                    end
                }
            }
        })
    end,
})

-- Credits Section
SettingsTab:CreateSection("ℹ️ About & Credits")

SettingsTab:CreateParagraph({
    Title = "LAJ HUB " .. LAJ.Version,
    Content = "Developed by: LAJ Development Team\n\nThanks for using LAJ HUB! Join our Discord for updates, key giveaways, and support."
})

SettingsTab:CreateButton({
    Name = "🔗 Join Discord",
    Info = "Get support and updates",
    Callback = function()
        if setclipboard then
            setclipboard("https://discord.gg/4mgdcfvAJU")
            LAJ.Log("Info", "Discord invite copied to clipboard")
        end
    end,
})

SettingsTab:CreateButton({
    Name = "⭐ Rate Us",
    Info = "Rate LAJ HUB on our website",
    Callback = function()
        LAJ.Log("Info", "Thanks for considering rating us!")
    end,
})

-- Auto Execute Logic
if LAJ.Config.AutoExecute then
    for scriptName, enabled in pairs(LAJ.Config.AutoExecute) do
        if enabled then
            if scriptName == "Infinite Yield" then
                LAJ.LoadScript("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", "Infinite Yield (Auto)")
            elseif scriptName == "ESP" then
                LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/esp", "ESP (Auto)")
            elseif scriptName == "Silent Aim" then
                LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/silentaim", "Silent Aim (Auto)")
            elseif scriptName == "FPS Booster" then
                LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/fpsbooster", "FPS Booster (Auto)")
            elseif scriptName == "Anti-AFK" then
                LAJ.LoadScript("https://raw.githubusercontent.com/LAJHubPremium/scripts/main/antiafk", "Anti-AFK (Auto)")
            end
        end
    end
end

-- TrixAde Auto-Detection System
-- This automatically detects and offers to run TrixAde scripts for the current game
if gameInfo.Script then
    Rayfield:Notify({
        Title = "TrixAde Script Available!",
        Content = "A compatible TrixAde script was found for " .. gameInfo.Name .. ". Would you like to execute it?",
        Duration = 10,
        Actions = {
            Accept = {
                Name = "Yes",
                Callback = function()
                    LAJ.LoadScript(gameInfo.Script, gameInfo.Name .. " (TrixAde)")
                    LAJ.Log("Success", "Executed TrixAde script for " .. gameInfo.Name)
                end
            },
            Decline = {
                Name = "No",
                Callback = function()
                    LAJ.Log("Info", "TrixAde script execution declined")
                end
            }
        }
    })
end

-- Select appropriate tab based on game
local currentGame = LAJ.GetCurrentGame()
if currentGame.Name ~= "Universal" then
    GamesTab:Select()
else
    DashboardTab:Select()
end

-- Final initialization
Rayfield:LoadConfiguration()

-- Display welcome message
LAJ.Log("Success", "LAJ HUB " .. LAJ.Version .. " loaded successfully!")
